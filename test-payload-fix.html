<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Payload Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .mobile-input-container {
            display: flex;
            align-items: stretch;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            background: white;
            margin-bottom: 10px;
        }
        .country-code-wrapper {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border-right: 1px solid #ddd;
            min-width: 120px;
        }
        .country-code-select {
            border: none;
            background: transparent;
            padding: 12px 8px;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            width: 100%;
        }
        .mobile-input-container .mobile-input {
            border: none;
            flex: 1;
            padding: 12px 15px;
            font-size: 16px;
            outline: none;
            background: transparent;
        }
        .verify-btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 10px 5px 0 0;
        }
        .verify-btn:disabled { 
            background: #ccc; 
            cursor: not-allowed; 
        }
        .payload-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { background: #e7f3ff; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .radio-group { display: flex; gap: 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Payload Fix Verification</h1>
    
    <div class="info">
        <h3>Testing Correct Payload Structure:</h3>
        <p>This test verifies that the API payload correctly separates country code and mobile number.</p>
        <ul>
            <li><strong>Issue:</strong> country_code was getting full number, mobile_number was getting partial</li>
            <li><strong>Fix:</strong> Pass country code and mobile number separately to sendOtp()</li>
            <li><strong>Expected:</strong> country_code: "+91", mobile_number: "1095656"</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>Mobile Number Input Test</h3>
        
        <div class="form-group">
            <label><strong>Select Location:</strong></label>
            <div class="radio-group">
                <label>
                    <input type="radio" name="location_type" value="0" checked> India
                </label>
                <label>
                    <input type="radio" name="location_type" value="1"> Outside India
                </label>
            </div>
        </div>

        <div class="mobile-input-container">
            <div class="country-code-wrapper">
                <select id="country-code-select" class="country-code-select">
                    <option value="+91" data-country="IN">üáÆüá≥ +91</option>
                    <option value="+1" data-country="US">üá∫üá∏ +1</option>
                    <option value="+44" data-country="GB">üá¨üáß +44</option>
                    <option value="+86" data-country="CN">üá®üá≥ +86</option>
                    <option value="+33" data-country="FR">üá´üá∑ +33</option>
                </select>
            </div>
            <input type="tel" id="mobile-number" name="contact" class="mobile-input" placeholder="Enter mobile number" value="1095656">
        </div>
        
        <button type="button" id="test-payload" class="verify-btn">Test Payload</button>
        
        <h4>Current Values:</h4>
        <div id="current-values" class="payload-display"></div>
        
        <h4>Expected API Payload:</h4>
        <div id="api-payload" class="payload-display"></div>
        
        <h4>Test Results:</h4>
        <div id="test-results" class="payload-display"></div>
    </div>

    <script>
        const countryCodeSelect = document.getElementById('country-code-select');
        const mobileInput = document.getElementById('mobile-number');
        const testBtn = document.getElementById('test-payload');
        const currentValues = document.getElementById('current-values');
        const apiPayload = document.getElementById('api-payload');
        const testResults = document.getElementById('test-results');
        
        function updateDisplay() {
            const countryCode = countryCodeSelect.value;
            const mobile = mobileInput.value.trim();
            const fullMobileNumber = countryCode + mobile;
            
            // Show current values
            currentValues.textContent = 
                `Country Code: "${countryCode}"\n` +
                `Mobile Number: "${mobile}"\n` +
                `Full Number: "${fullMobileNumber}"`;
            
            // Show expected API payload
            const expectedPayload = {
                mobile_number: mobile,
                country_code: countryCode,
                location_type: 0
            };
            
            apiPayload.textContent = 
                'Expected API Payload:\n' +
                JSON.stringify(expectedPayload, null, 2);
            
            // Test the extraction logic
            testExtractionLogic(fullMobileNumber, countryCode, mobile);
        }
        
        function testExtractionLogic(fullNumber, expectedCountryCode, expectedMobile) {
            // Test the old problematic regex
            const oldRegex = /^(\+\d+)(.+)$/;
            const oldMatch = fullNumber.match(oldRegex);
            
            // Test the new improved regex
            const newRegex = /^(\+\d{1,4})(.+)$/;
            const newMatch = fullNumber.match(newRegex);
            
            let results = 'EXTRACTION LOGIC TEST:\n\n';
            
            results += `Input: "${fullNumber}"\n`;
            results += `Expected Country Code: "${expectedCountryCode}"\n`;
            results += `Expected Mobile: "${expectedMobile}"\n\n`;
            
            // Old regex results
            if (oldMatch) {
                results += `‚ùå OLD REGEX /^(\\+\\d+)(.+)$/:\n`;
                results += `   Country Code: "${oldMatch[1]}"\n`;
                results += `   Mobile Number: "${oldMatch[2]}"\n`;
                results += `   Issue: Greedy \\d+ captures too many digits\n\n`;
            }
            
            // New regex results
            if (newMatch) {
                results += `‚úÖ NEW REGEX /^(\\+\\d{1,4})(.+)$/:\n`;
                results += `   Country Code: "${newMatch[1]}"\n`;
                results += `   Mobile Number: "${newMatch[2]}"\n`;
                
                const isCountryCodeCorrect = newMatch[1] === expectedCountryCode;
                const isMobileCorrect = newMatch[2] === expectedMobile;
                
                if (isCountryCodeCorrect && isMobileCorrect) {
                    results += `   ‚úÖ CORRECT: Both fields extracted properly\n\n`;
                } else {
                    results += `   ‚ùå INCORRECT: Extraction failed\n\n`;
                }
            }
            
            // New approach (separate parameters)
            results += `üéØ NEW APPROACH (Separate Parameters):\n`;
            results += `   sendOtp("${expectedMobile}", "${expectedCountryCode}")\n`;
            results += `   ‚úÖ PERFECT: No parsing needed, direct values\n`;
            
            testResults.textContent = results;
        }
        
        // Test different country codes
        function testMultipleCountryCodes() {
            const testCases = [
                { country: '+91', mobile: '1095656', description: 'India' },
                { country: '+1', mobile: '5551234567', description: 'USA' },
                { country: '+44', mobile: '7911123456', description: 'UK' },
                { country: '+86', mobile: '13812345678', description: 'China' },
                { country: '+33', mobile: '612345678', description: 'France' }
            ];
            
            let allResults = 'MULTIPLE COUNTRY CODE TESTS:\n\n';
            
            testCases.forEach(test => {
                const fullNumber = test.country + test.mobile;
                const newRegex = /^(\+\d{1,4})(.+)$/;
                const match = fullNumber.match(newRegex);
                
                allResults += `${test.description} (${test.country}):\n`;
                allResults += `  Input: "${fullNumber}"\n`;
                
                if (match) {
                    const extractedCountry = match[1];
                    const extractedMobile = match[2];
                    const isCorrect = extractedCountry === test.country && extractedMobile === test.mobile;
                    
                    allResults += `  Extracted: country="${extractedCountry}", mobile="${extractedMobile}"\n`;
                    allResults += `  Result: ${isCorrect ? '‚úÖ CORRECT' : '‚ùå INCORRECT'}\n\n`;
                } else {
                    allResults += `  Result: ‚ùå NO MATCH\n\n`;
                }
            });
            
            testResults.textContent = allResults;
        }
        
        // Event listeners
        testBtn.addEventListener('click', updateDisplay);
        countryCodeSelect.addEventListener('change', updateDisplay);
        mobileInput.addEventListener('input', updateDisplay);
        
        // Test button for multiple country codes
        const multiTestBtn = document.createElement('button');
        multiTestBtn.textContent = 'Test Multiple Country Codes';
        multiTestBtn.className = 'verify-btn';
        multiTestBtn.style.background = '#28a745';
        multiTestBtn.addEventListener('click', testMultipleCountryCodes);
        testBtn.parentNode.insertBefore(multiTestBtn, testBtn.nextSibling);
        
        // Initialize
        updateDisplay();
    </script>
</body>
</html>