<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Payload Structure</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .payload-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover { background: #0056b3; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { background: #e7f3ff; padding: 15px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>API Payload Structure Test</h1>
    
    <div class="info">
        <h3>Testing API Payload Changes:</h3>
        <p>This test verifies that the API calls now send <code>mobile_number</code> and <code>country_code</code> as separate fields instead of combining them.</p>
        <ul>
            <li><strong>Before:</strong> <code>mobile_number: "+919876543210"</code></li>
            <li><strong>After:</strong> <code>mobile_number: "9876543210", country_code: "+91"</code></li>
        </ul>
    </div>

    <div class="test-section">
        <h3>1. Send OTP API Test</h3>
        <p>Test the payload structure for <code>/api/send-otp</code> endpoint:</p>
        
        <label>Country Code: 
            <select id="test-country-code">
                <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
                <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
            </select>
        </label>
        <br><br>
        
        <label>Mobile Number: 
            <input type="tel" id="test-mobile" placeholder="9876543210" value="9876543210">
        </label>
        <br><br>
        
        <button class="test-btn" onclick="testSendOTP()">Test Send OTP Payload</button>
        
        <div id="send-otp-payload" class="payload-display"></div>
    </div>

    <div class="test-section">
        <h3>2. Verify OTP API Test</h3>
        <p>Test the payload structure for <code>/api/verify-otp</code> endpoint:</p>
        
        <label>OTP: 
            <input type="text" id="test-otp" placeholder="123456" value="123456" maxlength="6">
        </label>
        <br><br>
        
        <button class="test-btn" onclick="testVerifyOTP()">Test Verify OTP Payload</button>
        
        <div id="verify-otp-payload" class="payload-display"></div>
    </div>

    <div class="test-section">
        <h3>3. Registration API Test</h3>
        <p>Test the payload structure for <code>/api/register</code> endpoint:</p>
        
        <button class="test-btn" onclick="testRegistrationPayload()">Test Registration Payload</button>
        
        <div id="registration-payload" class="payload-display"></div>
    </div>

    <div class="test-section">
        <h3>4. API Call Simulation</h3>
        <p>Simulate actual API calls to see the network requests:</p>
        
        <button class="test-btn" onclick="simulateAPICalls()">Simulate API Calls</button>
        
        <div id="api-simulation" class="payload-display"></div>
    </div>

    <script>
        function testSendOTP() {
            const countryCode = document.getElementById('test-country-code').value;
            const mobileNumber = document.getElementById('test-mobile').value;
            
            // Simulate the payload structure used in sendOtp function
            const payload = {
                mobile_number: mobileNumber, // Mobile number without country code
                country_code: countryCode,   // Country code separately
                location_type: 0
            };
            
            document.getElementById('send-otp-payload').innerHTML = 
                '<strong>Send OTP Payload:</strong>\n' + 
                JSON.stringify(payload, null, 2) + '\n\n' +
                '<span class="success">âœ“ Country code and mobile number are now separate fields</span>';
        }

        function testVerifyOTP() {
            const countryCode = document.getElementById('test-country-code').value;
            const mobileNumber = document.getElementById('test-mobile').value;
            const otp = document.getElementById('test-otp').value;
            
            // Simulate the FormData structure used in verify-otp
            const formDataEntries = {
                mobile_number: mobileNumber, // Mobile number without country code
                country_code: countryCode,   // Country code separately
                location_type: '0',
                otp: otp
            };
            
            document.getElementById('verify-otp-payload').innerHTML = 
                '<strong>Verify OTP FormData:</strong>\n' + 
                JSON.stringify(formDataEntries, null, 2) + '\n\n' +
                '<span class="success">âœ“ Country code and mobile number are now separate fields</span>';
        }

        function testRegistrationPayload() {
            const countryCode = document.getElementById('test-country-code').value;
            const mobileNumber = document.getElementById('test-mobile').value;
            
            // Simulate the registration payload structure
            const payload = {
                full_name: "John Doe",
                year_of_completion: 2020,
                state_id: 1,
                email: "john@example.com",
                mobile_number: mobileNumber, // Mobile number without country code
                country_code: countryCode,   // Country code separately (now from actual selection)
                occupation: "Software Engineer",
                current_location: "Mumbai",
                level_completed: "Advanced",
                center_id: 1,
                pincode_id: 1,
                location_type: 0
            };
            
            document.getElementById('registration-payload').innerHTML = 
                '<strong>Registration Payload:</strong>\n' + 
                JSON.stringify(payload, null, 2) + '\n\n' +
                '<span class="success">âœ“ Country code now comes from actual selection, not hardcoded</span>';
        }

        function simulateAPICalls() {
            const countryCode = document.getElementById('test-country-code').value;
            const mobileNumber = document.getElementById('test-mobile').value;
            
            let output = '<strong>Simulated API Calls:</strong>\n\n';
            
            // 1. Send OTP Call
            output += '1. POST /api/send-otp\n';
            output += 'Content-Type: application/json\n';
            output += 'Body: ' + JSON.stringify({
                mobile_number: mobileNumber,
                country_code: countryCode,
                location_type: 0
            }, null, 2) + '\n\n';
            
            // 2. Verify OTP Call
            output += '2. POST /api/verify-otp\n';
            output += 'Content-Type: multipart/form-data\n';
            output += 'FormData:\n';
            output += '  mobile_number: ' + mobileNumber + '\n';
            output += '  country_code: ' + countryCode + '\n';
            output += '  location_type: 0\n';
            output += '  otp: 123456\n\n';
            
            // 3. Registration Call
            output += '3. POST /api/register\n';
            output += 'Content-Type: application/json\n';
            output += 'Body: ' + JSON.stringify({
                mobile_number: mobileNumber,
                country_code: countryCode,
                location_type: 0,
                "...": "other registration fields"
            }, null, 2) + '\n\n';
            
            output += '<span class="success">âœ“ All API calls now send country_code as separate field</span>';
            
            document.getElementById('api-simulation').innerHTML = output;
        }

        // Initialize with default values
        document.addEventListener('DOMContentLoaded', function() {
            testSendOTP();
            testVerifyOTP();
            testRegistrationPayload();
            simulateAPICalls();
        });
    </script>
</body>
</html>