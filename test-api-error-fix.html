<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Error Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin: 15px 0; }
        .radio-group { display: flex; gap: 20px; margin: 10px 0; }
        .email-verify-wrapper, .mobile-verify-wrapper { 
            border: 1px solid #ccc; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px;
        }
        .verify-btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        .verify-btn:disabled { 
            background: #ccc; 
            cursor: not-allowed; 
        }
        input[readonly] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        .status { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 4px; 
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h2>Test API Error Handling Fix</h2>
    <p>This test simulates API success/failure to verify that input fields only become readonly on successful API calls.</p>
    
    <div class="form-group">
        <label>Select Location:</label>
        <div class="radio-group">
            <label>
                <input type="radio" name="location_type" value="0" checked> India
            </label>
            <label>
                <input type="radio" name="location_type" value="1"> Outside India
            </label>
        </div>
    </div>

    <div class="email-verify-wrapper" style="display: none;">
        <h4>Email Verification (Outside India)</h4>
        <input type="email" id="email-input" placeholder="Email Address">
        <button type="button" id="verify-email-btn" class="verify-btn">Verify Email</button>
        <button type="button" id="simulate-email-error" class="verify-btn" style="background: #dc3545;">Simulate API Error</button>
        <div id="email-status"></div>
    </div>

    <div class="mobile-verify-wrapper">
        <h4>Mobile Verification</h4>
        <input type="tel" id="mobile-input" placeholder="Mobile Number">
        <button type="button" id="verify-mobile-btn" class="verify-btn">Verify Mobile</button>
        <button type="button" id="simulate-mobile-error" class="verify-btn" style="background: #dc3545;">Simulate API Error</button>
        <div id="mobile-status"></div>
    </div>

    <div class="status">
        <h4>Test Instructions:</h4>
        <ul>
            <li><strong>Success Test:</strong> Click "Verify Email" or "Verify Mobile" - input should become readonly and show success message</li>
            <li><strong>Error Test:</strong> Click "Simulate API Error" - input should remain editable and show error message</li>
            <li><strong>Expected Behavior:</strong> Input fields should only become readonly when API call is successful</li>
        </ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const locationRadios = document.querySelectorAll('input[name="location_type"]');
            const emailWrapper = document.querySelector('.email-verify-wrapper');
            const mobileWrapper = document.querySelector('.mobile-verify-wrapper');
            const emailInput = document.getElementById('email-input');
            const mobileInput = document.getElementById('mobile-input');
            const verifyEmailBtn = document.getElementById('verify-email-btn');
            const verifyMobileBtn = document.getElementById('verify-mobile-btn');
            const simulateEmailError = document.getElementById('simulate-email-error');
            const simulateMobileError = document.getElementById('simulate-mobile-error');
            const emailStatus = document.getElementById('email-status');
            const mobileStatus = document.getElementById('mobile-status');

            function showStatus(element, message, isError = false) {
                element.innerHTML = `<div class="status ${isError ? 'error' : 'success'}">${message}</div>`;
            }

            function simulateApiCall(isSuccess, input, button, statusElement, type) {
                // Disable button and show loading
                button.textContent = 'Sending...';
                button.disabled = true;
                
                // Don't make input readonly here - wait for API response
                
                setTimeout(() => {
                    if (isSuccess) {
                        // Simulate successful API response
                        showStatus(statusElement, `✓ OTP has been sent to your ${type}`, false);
                        
                        // Only make input readonly on success
                        input.readOnly = true;
                        
                        button.textContent = `${type} Verified`;
                        button.style.background = '#28a745';
                    } else {
                        // Simulate API error
                        showStatus(statusElement, `✗ Failed to send ${type} OTP. Please try again.`, true);
                        
                        // Keep input editable on error
                        input.readOnly = false;
                        
                        // Reset button
                        button.textContent = `Verify ${type}`;
                        button.disabled = false;
                        button.style.background = '#007bff';
                    }
                }, 1500); // Simulate network delay
            }

            // Handle location selection
            locationRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === '0') { // India
                        emailWrapper.style.display = 'none';
                        mobileWrapper.style.display = 'block';
                    } else { // Outside India
                        emailWrapper.style.display = 'block';
                        mobileWrapper.style.display = 'block';
                    }
                });
            });

            // Email verification - success
            verifyEmailBtn.addEventListener('click', function() {
                if (!emailInput.value.trim()) {
                    showStatus(emailStatus, 'Please enter an email address', true);
                    return;
                }
                simulateApiCall(true, emailInput, this, emailStatus, 'Email');
            });

            // Email verification - error
            simulateEmailError.addEventListener('click', function() {
                if (!emailInput.value.trim()) {
                    showStatus(emailStatus, 'Please enter an email address', true);
                    return;
                }
                simulateApiCall(false, emailInput, verifyEmailBtn, emailStatus, 'Email');
            });

            // Mobile verification - success
            verifyMobileBtn.addEventListener('click', function() {
                if (!mobileInput.value.trim()) {
                    showStatus(mobileStatus, 'Please enter a mobile number', true);
                    return;
                }
                simulateApiCall(true, mobileInput, this, mobileStatus, 'Mobile');
            });

            // Mobile verification - error
            simulateMobileError.addEventListener('click', function() {
                if (!mobileInput.value.trim()) {
                    showStatus(mobileStatus, 'Please enter a mobile number', true);
                    return;
                }
                simulateApiCall(false, mobileInput, verifyMobileBtn, mobileStatus, 'Mobile');
            });
        });
    </script>
</body>
</html>