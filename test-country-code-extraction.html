<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Country Code Extraction Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .test-case {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        .info { background: #e7f3ff; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-family: monospace;
        }
        .comparison-table th {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        .verify-btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 10px 5px 0 0;
        }
    </style>
</head>
<body>
    <h1>Country Code Extraction Fix Test</h1>
    
    <div class="info">
        <h3>Problem & Solution:</h3>
        <ul>
            <li><strong>Issue:</strong> Regex parsing was incorrectly splitting country codes and mobile numbers</li>
            <li><strong>Example:</strong> "+9127353751" ‚Üí country_code: "+9127", mobile_number: "353751" ‚ùå</li>
            <li><strong>Solution:</strong> Use proper country code lookup table instead of regex</li>
            <li><strong>Expected:</strong> "+9127353751" ‚Üí country_code: "+91", mobile_number: "27353751" ‚úÖ</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>Country Code Extraction Function</h3>
        <p>Testing the new country code extraction logic:</p>
        
        <button class="verify-btn" onclick="runAllTests()">Run All Tests</button>
        <button class="verify-btn" onclick="testCustomInput()" style="background: #28a745;">Test Custom Input</button>
        
        <br><br>
        <label>Custom Input: </label>
        <input type="text" id="custom-input" placeholder="+9127353751" value="+9127353751" style="padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px;">
        
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h3>Comparison: Old vs New Method</h3>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Input</th>
                    <th>Old Regex Method</th>
                    <th>New Lookup Method</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="comparison-table">
            </tbody>
        </table>
    </div>

    <script>
        // New country code extraction function (same as implemented in main code)
        function extractCountryCodeAndMobile(fullNumber) {
            // Common country codes (sorted by length, longest first to avoid partial matches)
            const countryCodes = [
                '+1242', '+1246', '+1264', '+1268', '+1284', '+1340', '+1345', '+1441', '+1473', '+1649', '+1664', '+1670', '+1671', '+1684', '+1721', '+1758', '+1767', '+1784', '+1787', '+1809', '+1829', '+1849', '+1868', '+1869', '+1876', '+1939',
                '+358', '+370', '+371', '+372', '+373', '+374', '+375', '+376', '+377', '+378', '+380', '+381', '+382', '+383', '+385', '+386', '+387', '+389', '+420', '+421', '+423', '+590', '+591', '+592', '+593', '+594', '+595', '+596', '+597', '+598', '+599', '+670', '+672', '+673', '+674', '+675', '+676', '+677', '+678', '+679', '+680', '+681', '+682', '+683', '+684', '+685', '+686', '+687', '+688', '+689', '+690', '+691', '+692', '+850', '+852', '+853', '+855', '+856', '+880', '+886', '+960', '+961', '+962', '+963', '+964', '+965', '+966', '+967', '+968', '+970', '+971', '+972', '+973', '+974', '+975', '+976', '+977', '+992', '+993', '+994', '+995', '+996', '+998',
                '+93', '+94', '+95', '+98', '+20', '+27', '+30', '+31', '+32', '+33', '+34', '+36', '+39', '+40', '+41', '+43', '+44', '+45', '+46', '+47', '+48', '+49', '+51', '+52', '+53', '+54', '+55', '+56', '+57', '+58', '+60', '+61', '+62', '+63', '+64', '+65', '+66', '+81', '+82', '+84', '+86', '+90', '+91', '+92',
                '+1', '+7'
            ];
            
            // Find the matching country code
            for (const code of countryCodes) {
                if (fullNumber.startsWith(code)) {
                    return {
                        countryCode: code,
                        mobileNumber: fullNumber.substring(code.length)
                    };
                }
            }
            
            // Fallback: assume +91 if no match found
            return {
                countryCode: '+91',
                mobileNumber: fullNumber.replace(/^\+91/, '')
            };
        }

        // Old regex method (for comparison)
        function oldRegexMethod(fullNumber) {
            const countryCodeMatch = fullNumber.match(/^(\+\d{1,4})(.+)$/);
            return {
                countryCode: countryCodeMatch ? countryCodeMatch[1] : '+91',
                mobileNumber: countryCodeMatch ? countryCodeMatch[2] : fullNumber.replace(/^\+\d{1,4}/, '')
            };
        }

        function testSingleInput(input, expectedCountry, expectedMobile) {
            const newResult = extractCountryCodeAndMobile(input);
            const oldResult = oldRegexMethod(input);
            
            const newCorrect = newResult.countryCode === expectedCountry && newResult.mobileNumber === expectedMobile;
            const oldCorrect = oldResult.countryCode === expectedCountry && oldResult.mobileNumber === expectedMobile;
            
            return {
                input,
                expected: { country: expectedCountry, mobile: expectedMobile },
                old: oldResult,
                new: newResult,
                oldCorrect,
                newCorrect
            };
        }

        function runAllTests() {
            const testCases = [
                { input: '+9127353751', expectedCountry: '+91', expectedMobile: '27353751', name: 'India (problematic case)' },
                { input: '+911234567890', expectedCountry: '+91', expectedMobile: '1234567890', name: 'India (normal case)' },
                { input: '+15551234567', expectedCountry: '+1', expectedMobile: '5551234567', name: 'USA' },
                { input: '+447911123456', expectedCountry: '+44', expectedMobile: '7911123456', name: 'UK' },
                { input: '+8613812345678', expectedCountry: '+86', expectedMobile: '13812345678', name: 'China' },
                { input: '+33612345678', expectedCountry: '+33', expectedMobile: '612345678', name: 'France' },
                { input: '+852123456789', expectedCountry: '+852', expectedMobile: '123456789', name: 'Hong Kong' },
                { input: '+971501234567', expectedCountry: '+971', expectedMobile: '501234567', name: 'UAE' }
            ];

            let results = '<h4>Test Results:</h4>';
            let passCount = 0;
            let comparisonRows = '';

            testCases.forEach(test => {
                const result = testSingleInput(test.input, test.expectedCountry, test.expectedMobile);
                
                const status = result.newCorrect ? 'success' : 'error';
                const statusText = result.newCorrect ? '‚úÖ PASS' : '‚ùå FAIL';
                
                results += `
                    <div class="test-case ${status}">
                        <strong>${test.name}</strong><br>
                        Input: <code>${result.input}</code><br>
                        Expected: country=<code>${result.expected.country}</code>, mobile=<code>${result.expected.mobile}</code><br>
                        New Method: country=<code>${result.new.countryCode}</code>, mobile=<code>${result.new.mobileNumber}</code><br>
                        Result: ${statusText}
                    </div>
                `;

                comparisonRows += `
                    <tr>
                        <td>${result.input}</td>
                        <td class="${result.oldCorrect ? 'success' : 'error'}">
                            country: "${result.old.countryCode}"<br>
                            mobile: "${result.old.mobileNumber}"<br>
                            ${result.oldCorrect ? '‚úÖ' : '‚ùå'}
                        </td>
                        <td class="${result.newCorrect ? 'success' : 'error'}">
                            country: "${result.new.countryCode}"<br>
                            mobile: "${result.new.mobileNumber}"<br>
                            ${result.newCorrect ? '‚úÖ' : '‚ùå'}
                        </td>
                        <td class="${result.newCorrect ? 'success' : 'error'}">
                            ${result.newCorrect ? 'FIXED' : 'ISSUE'}
                        </td>
                    </tr>
                `;

                if (result.newCorrect) passCount++;
            });

            results += `
                <div class="test-case ${passCount === testCases.length ? 'success' : 'warning'}">
                    <strong>Summary:</strong> ${passCount}/${testCases.length} tests passed
                    ${passCount === testCases.length ? 'üéâ All tests passed!' : '‚ö†Ô∏è Some tests failed'}
                </div>
            `;

            document.getElementById('test-results').innerHTML = results;
            document.getElementById('comparison-table').innerHTML = comparisonRows;
        }

        function testCustomInput() {
            const input = document.getElementById('custom-input').value.trim();
            if (!input) {
                alert('Please enter a phone number to test');
                return;
            }

            const newResult = extractCountryCodeAndMobile(input);
            const oldResult = oldRegexMethod(input);

            const results = `
                <h4>Custom Input Test:</h4>
                <div class="test-case">
                    <strong>Input:</strong> <code>${input}</code><br><br>
                    <strong>Old Regex Method:</strong><br>
                    Country Code: <code>${oldResult.countryCode}</code><br>
                    Mobile Number: <code>${oldResult.mobileNumber}</code><br><br>
                    <strong>New Lookup Method:</strong><br>
                    Country Code: <code>${newResult.countryCode}</code><br>
                    Mobile Number: <code>${newResult.mobileNumber}</code><br><br>
                    <strong>Improvement:</strong> ${newResult.countryCode !== oldResult.countryCode || newResult.mobileNumber !== oldResult.mobileNumber ? '‚úÖ Different result' : '‚ö™ Same result'}
                </div>
            `;

            document.getElementById('test-results').innerHTML = results;
        }

        // Run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            runAllTests();
        });
    </script>
</body>
</html>